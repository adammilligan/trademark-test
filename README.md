# High-Performance AI Chat Interface (тестовое задание)

Одностраничное приложение, эмулирующее работу AI‑чата с **потоковой генерацией текста**, с акцентом на **плавность интерфейса**, **отзывчивость при длинной истории** и аккуратную архитектуру по FSD.

**Техническое задание**: [Ссылка на ТЗ](https://docviewer.yandex.ru/view/357104019/?*=uavmRbRvb4a9iS9EjpuLNTZgCR57InVybCI6InlhLWRpc2stcHVibGljOi8vbGJLaDFQeEF6V0JHMGdIVWxxb05jTEJ4a21Kak90cE1MM0NxVExZb3hkV2EyOW9vbWFkZzhFOFUwWFhhazlXYXEvSjZicG1SeU9Kb25UM1ZvWG5EYWc9PSIsInRpdGxlIjoi0YLQtyBmcm9udGVuZC50eHQiLCJub2lmcmFtZSI6ZmFsc2UsInVpZCI6IjM1NzEwNDAxOSIsInRzIjoxNzY4OTg0NDk2ODA4LCJ5dSI6Ijc2NzcyOTMwNDE3NDE1NDEwMDUifQ%3D%3D)

---

## Как запустить

```bash
npm install      # установка зависимостей
npm run dev      # запуск dev‑сервера
```

По умолчанию Vite поднимает приложение на `http://localhost:5173`.

Дополнительные команды:

```bash
npm run build    # production‑сборка
npm run preview  # предпросмотр сборки
npm run lint     # проверка ESLint
npm run lint:fix # автопочинка ESLint
```

---

## Основные возможности

- **Потоковая генерация ответов**
  - Ответы ассистента приходят **потоком, слово за словом**, создавая эффект «печатающегося» текста.
  - Для ответов на пользовательские сообщения генерируется **100–500 слов**, для кнопки **Generate** — **1000–10000 слов** в одном сообщении.

- **Управление генерацией**
  - Кнопка **Generate** запускает длинную потоковую генерацию.
  - Кнопка **Stop Generating** останавливает текущий поток и фиксирует текст.
  - Во время генерации можно продолжать вводить новый запрос; при отправке:
    - текущий поток **аккуратно останавливается**,
    - создаётся сообщение пользователя,
    - запускается **новый потоковый ответ** на этот запрос.
---

## Стек и архитектура

- **Стек**
  - **React 18 + TypeScript**
  - **Zustand** — состояние чата и управление сессией генерации.
  - **Vite** — сборка и dev‑сервер.
  - **Tailwind CSS** — стили и адаптивный layout.
  - **react-markdown + remark-gfm** — рендер Markdown.

- **Архитектура (FSD)**
  - `app/` — точка входа, глобальные стили.
  - `pages/` — страницы (`ChatPage`).
  - `widgets/` — крупные композиции (`ChatWidget`: панель генерации + список сообщений + инпут).
  - `features/` — прикладные сценарии (форма ввода сообщения, панель управления генерацией).
  - `entities/` — доменные сущности (чат, сообщение, Zustand‑стор).
  - `shared/` — общие утилиты, конфиги и генератор текста.
---

## Потоковая генерация и производительность

- **Поток по словам**
  - Генерация разбита на небольшие чанки по словам.
  - Чанки приходят с контролируемой задержкой — создаётся эффект «живого» ответа, но без перегрузки UI.

- **Буферизация и `requestAnimationFrame`**
  - Каждый чанк сначала попадает во **временный буфер**.
  - Запись в Zustand выполняется **внутри `requestAnimationFrame`**, что:
    - уменьшает количество перерисовок,
    - делает анимацию текста плавной даже при частых тиках.

- **Минимум лишних ререндеров**
  - Во время генерации обновляется **одно сообщение ассистента**, в которое доклеивается текст.
  - Список сообщений не пересобирается полностью — это важно при длинной истории.

- **Markdown без фризов**
  - Пока сообщение стримится, оно отображается как обычный текст.
  - После завершения генерации сообщение переключается на рендер через `react-markdown`, поэтому тяжёлый парсинг Markdown **не мешает** плавности потока.

---

## Управление состоянием (Zustand)

Вся логика чата собрана в `useChatStore`:

- хранение списка сообщений (роль, текст, признаки стриминга);
- флаги:
  - `isGenerating` — идёт ли сейчас генерация;
  - `isAutoScroll` — включён ли автоскролл;
- счётчики прогресса:
  - `generatedWords` — сколько слов уже сгенерировано;
  - `targetWords` — целевое количество слов для текущего ответа;
- методы:
  - старт длинной генерации по кнопке **Generate**;
  - потоковый ответ на пользовательский запрос;
  - остановка стрима с аккуратным завершением сообщения.

Runtime‑состояние (таймер, буфер, генератор слов) вынесено за пределы React‑состояния, чтобы не нагружать рендер постоянными апдейтами и сохранять плавный 60 FPS.

---

## Кодстайл и линтинг

- **Типы и интерфейсы**
  - Все `type` начинаются с префикса **`T`** (`TChatState`, `TChatMessage` и т.д.).
  - Все `interface` начинаются с префикса **`I`**.

- **ESLint**
  - ESLint с поддержкой TypeScript.
  - Подключён `eslint-plugin-perfectionист` для сортировки импортов и группировки по слоям FSD (`@shared`, `@entities`, `@features`, `@widgets`, `@pages`, `@app`).

- **Версионирование зависимостей**
  - В `.npmrc` включён `save-exact=true` — все версии фиксируются **без `^`**, чтобы сборка была воспроизводимой.

---

## Полезные файлы

- Логика стора и стриминга: `src/entities/chat/model/chatStore.ts`
- Конфигурация стриминга (скорость, диапазоны слов): `src/shared/config/chatConfig.ts`
- Генератор «осмысленного» текста с кодом и Markdown: `src/shared/lib/textGenerator.ts`
- Основной виджет чата: `src/widgets/chat/ui/ChatWidget.tsx`
- Список сообщений: `src/entities/message/ui/MessageList.tsx`
- Отдельное сообщение: `src/entities/message/ui/MessageItem.tsx`

